<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="productList">
    <!-- Erfolgsmeldung -->
    <div th:if="${param.success}" class="alert alert-success mt-lg">
        <span th:if="${param.updated}">Produkt erfolgreich aktualisiert!</span>
        <span th:if="${param.deleted}">Produkt erfolgreich gelöscht!</span>
        <span th:unless="${param.updated} or ${param.deleted}">Produkt erfolgreich hinzugefügt!</span>
    </div>
    
    <!-- Fehlermeldung -->
    <div th:if="${param.error}" class="alert alert-error mt-lg" th:text="${param.error}">
    </div>
    
    <!-- Produktliste -->
    <div class="card mt-lg">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>Produkte</h2>
            <div th:if="${role} == 'ADMIN'" class="add-product">
                <a th:href="@{/products/add}" class="btn btn-primary">Produkt hinzufügen</a>
            </div>
        </div>
        
        
        <div th:if="${products == null || #lists.isEmpty(products)}" class="text-center text-muted mt-md">
            <p>Noch keine Produkte vorhanden.</p>
        </div>
        
        <div th:unless="${products == null || #lists.isEmpty(products)}" class="grid grid-3 mt-md">
            <div th:each="product : ${products}" class="card">
                <img th:if="${product.imageUrl}" th:src="@{${product.imageUrl}}" 
                     th:alt="${product.name}" 
                     style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 1rem;">
                <h3 th:text="${product.name}"></h3>
                <p th:text="${product.description}" class="text-muted"></p>
                <p><strong th:text="${#numbers.formatDecimal(product.price, 1, 2)} + ' €'"></strong></p>
                
                <!-- Admin Buttons -->
                <div th:if="${role} == 'ADMIN'" style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <a th:href="@{/products/edit/{id}(id=${product.id})}" class="update-product ">Update</a>
                    <form th:action="@{/products/delete/{id}(id=${product.id})}" method="post"
                          onsubmit="return confirm('Möchtest du dieses Produkt wirklich löschen?');">
                        <button type="submit" class="delete-product">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>